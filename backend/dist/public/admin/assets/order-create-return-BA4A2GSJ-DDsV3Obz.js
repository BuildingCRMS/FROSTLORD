import{R as Me,C as De}from"./chunk-P3DRE4IY-DebchUSt.js";import{M as He}from"./chunk-NNBHHXXN-zAa1dPH9.js";import{g as me,D as Le}from"./chunk-PXZ7QYKX-DWqpVeoL.js";import{m as Fe,c as ze,n as Ve,u as Be,o as Ue,p as Oe,q as $e,s as Ge,t as Qe,v as Xe,w as Je}from"./chunk-GUHHFSZA-CPVweVTn.js";import{D as Ke}from"./chunk-D4T3GFML-k03o88f9.js";import{a as z}from"./chunk-PDWBYQOW-Dmlh1vBq.js";import{P as We,a as Ye}from"./chunk-IQBAUTU5-UA-T0GCI.js";import{R as Ze,u as et,b as H,aT as tt,aU as st,r as j,j as e,t as X,cS as nt,a8 as it,w as at,H as te,B as Q,v as m,T as V,y as Y,aa as rt,ab as ot,s as lt,cW as dt,aC as ct,I as se,A as ut,X as ne,a2 as ie,a3 as ae,a4 as L,ad as mt,af as pt}from"./index-C-aqpPpW.js";import{u as ft,_ as ht}from"./chunk-B2JT2FOA-D-TfFkrL.js";import"./lodash-CaNp2Tn5.js";import{C as Z}from"./chunk-2PMSBTXI-DuCuD73b.js";import{c as xt}from"./chunk-MWVM4TYO-bKUcYSnf.js";import"./chunk-GJUPECDU-D4jHO8Eu.js";import{u as gt}from"./chunk-C76H5USB-CapUlioK.js";import{K as _t}from"./chunk-6HTZNHPT-CgFEWPk_.js";import{R as P,u as bt,a as jt,S as F}from"./chunk-4TC5YS65-CUs0cNRB.js";import{u as yt}from"./chunk-GRT22PE5-BabToEai.js";import{u as vt}from"./use-prompt-4crEk_LW.js";import{P as Nt}from"./pencil-square-DEsgmMkQ.js";import{C as It}from"./currency-input-D2EZW0D9.js";import{X as St}from"./x-circle-CuAnE70G.js";import{A as Ct}from"./alert-C7_hy9xK.js";import{c as Rt}from"./index-Dk3u0-aQ.js";import{C as re}from"./checkbox-BI-NcABA.js";import"./Trans-BVu_5gwW.js";import"./chunk-P3UUX2T6-D5QCb5jW.js";import"./chunk-YEDAFXMB-Cry741uD.js";import"./chunk-AOFGTNG6-DpohskHP.js";import"./table-C-dNIP3m.js";import"./chunk-EMIHDNB7-CF7Wbal1.js";import"./plus-mini-DiXGmMQk.js";import"./command-bar-yphaa9qd.js";import"./index-ZwSr6h3z.js";import"./x-mark-mini-BfhzaRzl.js";import"./triangles-mini-DMlStY_2.js";import"./chunk-PFKKVLZX-WvaqRDsG.js";import"./format-DnoVlkiH.js";import"./_isIndex-Dg13dToS.js";import"./index-UFUZ2mUF.js";import"./date-picker-B5a0JSXg.js";import"./popover-D2Y_kR6I.js";import"./triangle-left-mini-D_svZAcQ.js";import"./prompt-Cl5xfF6Y.js";import"./index.esm-DsDUijok.js";var D=Rt(),wt=o=>{const{t:l}=H();return j.useMemo(()=>[D.display({id:"select",header:({table:a})=>e.jsx(re,{checked:a.getIsSomePageRowsSelected()?"indeterminate":a.getIsAllPageRowsSelected(),onCheckedChange:t=>a.toggleAllPageRowsSelected(!!t)}),cell:({row:a})=>{const t=a.getCanSelect();return e.jsx(re,{disabled:!t,checked:a.getIsSelected(),onCheckedChange:d=>a.toggleSelected(!!d),onClick:d=>{d.stopPropagation()}})}}),D.display({id:"product",header:()=>e.jsx(Ye,{}),cell:({row:a})=>e.jsx(We,{product:{thumbnail:a.original.thumbnail,title:a.original.product_title}})}),D.accessor("variant.sku",{header:l("fields.sku"),cell:({getValue:a})=>a()||"-"}),D.accessor("variant.title",{header:l("fields.variant")}),D.accessor("quantity",{header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:l("fields.quantity")})}),cell:({getValue:a,row:t})=>me(t.original)}),D.accessor("refundable_total",{header:()=>e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:l("fields.price")})}),cell:({getValue:a})=>{const t=a()||0,d=z(t,o);return e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:d})})}})],[l,o])},qt=()=>{const{t:o}=H();return[{key:"returnable_quantity",label:o("orders.returns.returnableQuantityLabel"),type:"number"},{key:"refundable_amount",label:o("orders.returns.refundableAmountLabel"),type:"number"},{key:"created_at",label:o("fields.createdAt"),type:"date"},{key:"updated_at",label:o("fields.updatedAt"),type:"date"}]},kt=({pageSize:o=50,prefix:l})=>{const a=gt(["q","offset","order","created_at","updated_at","returnable_quantity","refundable_amount"],l),{offset:t,created_at:d,updated_at:u,refundable_amount:c,returnable_quantity:g,...b}=a;return{searchParams:{...b,limit:o,offset:t?Number(t):0,created_at:d?JSON.parse(d):void 0,updated_at:u?JSON.parse(u):void 0,refundable_amount:c?JSON.parse(c):void 0,returnable_quantity:g?JSON.parse(g):void 0},raw:a}},K=50,oe="rit",Pt=({onSelectionChange:o,selectedItems:l,items:a,currencyCode:t})=>{const{t:d}=H(),[u,c]=j.useState(l.reduce((h,v)=>(h[v]=!0,h),{})),g=h=>{const v=typeof h=="function"?h(u):h;c(v),o(Object.keys(v))},{searchParams:b,raw:p}=kt({pageSize:K,prefix:oe}),y=j.useMemo(()=>{const{order:h,offset:v,limit:q,q:E,created_at:B,updated_at:U,refundable_amount:O,returnable_quantity:$}=b;let N=a;if(E&&(N=N.filter(k=>{var T;return k.product_title.toLowerCase().includes(E.toLowerCase())||k.variant_title.toLowerCase().includes(E.toLowerCase())||((T=k.variant_sku)==null?void 0:T.toLowerCase().includes(E.toLowerCase()))})),h){const k=h[0]==="-"?"desc":"asc",T=h.replace("-","");N=Et(N,T,k)}return B&&(N=le(N,B,"created_at")),U&&(N=le(N,U,"updated_at")),$&&(N=ce(N,$,"returnable_quantity",t)),O&&(N=ce(N,O,"refundable_amount",t)),N.slice(v,v+q)},[a,t,b]),w=wt(t),I=qt(),{table:_}=ft({data:y,columns:w,count:y.length,enablePagination:!0,getRowId:h=>h.id,pageSize:K,enableRowSelection:h=>me(h.original)>0,rowSelection:{state:u,updater:g}});return e.jsx("div",{className:"flex size-full flex-col overflow-hidden",children:e.jsx(ht,{table:_,columns:w,pageSize:K,count:y.length,filters:I,pagination:!0,layout:"fill",search:!0,orderBy:[{key:"product_title",label:d("fields.product")},{key:"variant_title",label:d("fields.variant")},{key:"sku",label:d("fields.sku")},{key:"returnable_quantity",label:d("orders.fields.returnableQuantity")},{key:"refundable_amount",label:d("orders.fields.refundableAmount")}],prefix:oe,queryObject:p})})},Et=(o,l,a)=>o.sort((t,d)=>{let u,c;return l==="product_title"?(u=t.product_title,c=d.product_title):l==="variant_title"?(u=t.variant_title,c=d.variant_title):l==="sku"?(u=t.variant_sku,c=d.variant_sku):l==="returnable_quantity"?(u=t.quantity-(t.returned_quantity||0),c=d.quantity-(d.returned_quantity||0)):l==="refundable_amount"&&(u=t.refundable||0,c=d.refundable||0),u<c?a==="asc"?-1:1:u>c?a==="asc"?1:-1:0}),le=(o,l,a)=>{const{gt:t,gte:d,lt:u,lte:c}=l;return o.filter(g=>{const b=new Date(g[a]);let p=!0;return t&&(p=p&&b>new Date(t)),d&&(p=p&&b>=new Date(d)),u&&(p=p&&b<new Date(u)),c&&(p=p&&b<=new Date(c)),p})},de={eq:void 0,gt:void 0,gte:void 0,lt:void 0,lte:void 0},ce=(o,l,a,t)=>{const{eq:d,gt:u,lt:c,gte:g,lte:b}=typeof l=="object"?{...de,...l}:{...de,eq:l};return o.filter(p=>{const y=p.quantity-(p.returned_quantity||0),w=z(p.refundable||0,t),I=a==="returnable_quantity"?y:w;if(d)return I===d;let _=!0;return u&&(_=_&&I>u),g&&(_=_&&I>=g),c&&(_=_&&I<c),b&&(_=_&&I<=b),_})};function Tt({item:o,previewItem:l,currencyCode:a,form:t,onRemove:d,onUpdate:u,index:c}){const{t:g}=H(),{return_reasons:b=[]}=dt({fields:"+label"}),p=t.watch(`items.${c}`),y=typeof p.reason_id=="string",w=typeof p.note=="string";return e.jsxs("div",{className:"bg-ui-bg-subtle shadow-elevation-card-rest my-2 rounded-xl ",children:[e.jsxs("div",{className:"flex flex-col items-center gap-x-2 gap-y-2 border-b p-3 text-sm md:flex-row",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-x-3",children:[e.jsx(ct,{src:o.thumbnail}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsxs(V,{className:"txt-small",as:"span",weight:"plus",children:[o.title," "]}),o.variant_sku&&e.jsxs("span",{children:["(",o.variant_sku,")"]})]}),e.jsx(V,{as:"div",className:"text-ui-fg-subtle txt-small",children:o.product_title})]})]}),e.jsxs("div",{className:"flex flex-1 justify-between",children:[e.jsxs("div",{className:"flex flex-grow items-center gap-2",children:[e.jsx(m.Field,{control:t.control,name:`items.${c}.quantity`,render:({field:I})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(se,{className:"bg-ui-bg-base txt-small w-[67px] rounded-lg",min:1,max:o.quantity,type:"number",...I,onChange:_=>{const h=_.target.value,v=h===""?null:Number(h);I.onChange(v),v&&u({quantity:v})}})}),e.jsx(m.ErrorMessage,{})]})}),e.jsx(V,{className:"txt-small text-ui-fg-subtle",children:g("fields.qty")})]}),e.jsx("div",{className:"text-ui-fg-subtle txt-small mr-2 flex flex-shrink-0",children:e.jsx(He,{currencyCode:a,amount:l.return_requested_total})}),e.jsx(ut,{groups:[{actions:[!y&&{label:g("actions.addReason"),onClick:()=>t.setValue(`items.${c}.reason_id`,""),icon:e.jsx(De,{})},!w&&{label:g("actions.addNote"),onClick:()=>t.setValue(`items.${c}.note`,""),icon:e.jsx(Le,{})},{label:g("actions.remove"),onClick:d,icon:e.jsx(St,{})}].filter(Boolean)}]})]})]}),e.jsxs(e.Fragment,{children:[y&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:g("orders.returns.reason")}),e.jsx(m.Hint,{className:"!mt-1",children:g("orders.returns.reasonHint")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(m.Field,{control:t.control,name:`items.${c}.reason_id`,render:({field:{ref:I,value:_,onChange:h,...v}})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(Z,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",value:_,onChange:q=>{u({reason_id:q}),h(q)},...v,options:b.map(q=>({label:q.label,value:q.id}))})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx(Y,{type:"button",className:"flex-shrink",variant:"transparent",onClick:()=>{u({reason_id:null}),t.setValue(`items.${c}.reason_id`,null)},children:e.jsx(ne,{className:"text-ui-fg-muted"})})]})]}),w&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:g("orders.returns.note")}),e.jsx(m.Hint,{className:"!mt-1",children:g("orders.returns.noteHint")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(m.Field,{control:t.control,name:`items.${c}.note`,render:({field:{ref:I,onChange:_,...h}})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(se,{onChange:_,...h,onBlur:()=>u({internal_note:h.value}),className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover"})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx(Y,{type:"button",className:"flex-shrink",variant:"transparent",onClick:()=>{t.setValue(`items.${c}.note`,{shouldDirty:!0,shouldTouch:!0}),u({internal_note:null})},children:e.jsx(ne,{className:"text-ui-fg-muted"})})]})]})]})]})}var At=ie({items:mt(ie({item_id:L(),quantity:pt(),reason_id:L().optional().nullable(),note:L().optional().nullable()})),location_id:L().optional(),option_id:L(),send_notification:ae().optional(),receive_now:ae().optional()}),ue=[],Mt=({order:o,preview:l,activeReturn:a})=>{const{t}=H(),{handleSuccess:d}=bt(),u=j.useMemo(()=>new Map((o.items||[]).map(n=>[n.id,n])),[o.items]),c=j.useMemo(()=>l.items.filter(n=>{var i;return!!((i=n.actions)!=null&&i.find(s=>s.return_id===a.id))}),[l.items]),g=j.useMemo(()=>new Map(c.map(n=>[n.id,n])),[c]),{setIsOpen:b}=jt(),[p,y]=j.useState(!1),[w,I]=j.useState({value:"0",float:0}),[_,h]=j.useState({}),{stock_locations:v=[]}=nt({limit:999}),{shipping_options:q=[]}=yt({limit:999,fields:"*prices,+service_zone.fulfillment_set.location.id"}),{mutateAsync:E,isPending:B}=Ve(a.id,o.id),{mutateAsync:U,isPending:O}=Be(a.id,o.id),{mutateAsync:$,isPending:N}=Ue(a.id,o.id),{mutateAsync:k,isPending:T}=Oe(a.id,o.id),{mutateAsync:pe,isPending:fe}=$e(a.id,o.id),{mutateAsync:he,isPending:xe}=Ge(a.id,o.id),{mutateAsync:ge,isPending:_e}=Qe(a.id,o.id),{mutateAsync:be,isPending:je}=Xe(a.id,o.id),{mutateAsync:ye,isPending:ve}=Je(a.id,o.id),Ne=B||O||T||fe||xe||_e||je||ve||N,C=it({defaultValues:()=>{const n=l.shipping_methods.find(i=>{var s;return!!((s=i.actions)!=null&&s.find(r=>r.action==="SHIPPING_ADD"))});return Promise.resolve({items:c.map(i=>{var s,r,f,x,S;return{item_id:i.id,quantity:i.detail.return_requested_quantity,note:(r=(s=i.actions)==null?void 0:s.find(M=>M.action==="RETURN_ITEM"))==null?void 0:r.internal_note,reason_id:(S=(x=(f=i.actions)==null?void 0:f.find(M=>M.action==="RETURN_ITEM"))==null?void 0:x.details)==null?void 0:S.reason_id}}),option_id:n?n.shipping_option_id:"",location_id:a==null?void 0:a.location_id,send_notification:!1})},resolver:ot(At)}),{fields:R,append:Ie,remove:Se,update:Ce}=at({name:"items",control:C.control});j.useEffect(()=>{const n={};c.forEach(i=>{var r,f;const s=R.findIndex(x=>x.item_id===i.id);if(i.detail.return_requested_quantity)if(n[i.id]=!0,s>-1){if(R[s].quantity!==i.detail.return_requested_quantity){const x=(r=i.actions)==null?void 0:r.find(S=>S.action==="RETURN_ITEM");Ce(s,{...R[s],quantity:i.detail.return_requested_quantity,note:x==null?void 0:x.internal_note,reason_id:(f=x==null?void 0:x.details)==null?void 0:f.reason_id})}}else Ie({item_id:i.id,quantity:i.detail.return_requested_quantity})}),R.forEach((i,s)=>{i.item_id in n||Se(s)})},[c]),j.useEffect(()=>{var i;const n=(i=l.shipping_methods)==null?void 0:i.find(s=>{var r;return!!((r=s.actions)!=null&&r.find(f=>f.action==="SHIPPING_ADD"))});n?C.setValue("option_id",n.shipping_option_id):C.setValue("option_id","")},[l.shipping_methods]);const G=!R.length,A=C.watch("location_id"),Re=C.watch("option_id"),we=vt(),qe=C.handleSubmit(async n=>{try{if(!await we({title:t("general.areYouSure"),description:t("orders.returns.confirmText"),confirmText:t("actions.continue"),cancelText:t("actions.cancel"),variant:"confirmation"}))return;await E({no_notification:!n.send_notification}),d()}catch(i){X.error(t("general.error"),{description:i.message,dismissLabel:t("actions.close")})}}),ke=()=>{ge({items:ue.map(n=>({id:n,quantity:1}))}),b("items",!1)},Pe=async n=>{await $({location_id:n})},Ee=async n=>{const i=l.shipping_methods.map(s=>{var r,f;return(f=(r=s.actions)==null?void 0:r.find(x=>x.action==="SHIPPING_ADD"))==null?void 0:f.id}).filter(Boolean).map(he);await Promise.all(i),n&&await k({shipping_option_id:n})};j.useEffect(()=>{p&&document.getElementById("js-shipping-input").focus()},[p]),j.useEffect(()=>{C.setValue("location_id",(a==null?void 0:a.location_id)||"")},[a]);const Te=j.useMemo(()=>A?!R.map(i=>{var r,f;const s=u.get(i.item_id);return!(s!=null&&s.variant_id)||!((r=s.variant)!=null&&r.manage_inventory)?!0:(f=_[s.variant_id])==null?void 0:f.find(x=>x.location_id===A)}).every(Boolean):!1,[R,_,A]);j.useEffect(()=>{(async()=>{const i={};return R.length&&(await Promise.all(R.map(async s=>{const r=u.get(s.item_id);if(r.variant_id)return await lt.admin.product.retrieveVariant(r.product_id,r.variant_id,{fields:"*inventory,*inventory.location_levels"})}))).filter(s=>s==null?void 0:s.variant).forEach(s=>{var x;const{variant:r}=s,f=(x=r.inventory[0])==null?void 0:x.location_levels;f&&(i[r.id]=f)}),i})().then(i=>{h(i)})},[R]);const J=l.return_requested_total,Ae=j.useMemo(()=>{const n=l.shipping_methods.find(i=>{var s;return!!((s=i.actions)!=null&&s.find(r=>r.action==="SHIPPING_ADD"))});return(n==null?void 0:n.total)||0},[l.shipping_methods]);return e.jsx(P.Form,{form:C,onClose:n=>{n||U()},children:e.jsxs(_t,{onSubmit:qe,className:"flex h-full flex-col",children:[e.jsx(P.Header,{}),e.jsx(P.Body,{className:"flex size-full justify-center overflow-y-auto",children:e.jsxs("div",{className:"mt-16 w-[720px] max-w-[100%] px-4 md:p-0",children:[e.jsx(te,{level:"h1",children:t("orders.returns.create")}),e.jsxs("div",{className:"mt-8 flex items-center justify-between",children:[e.jsx(te,{level:"h2",children:t("orders.returns.inbound")}),e.jsxs(F,{id:"items",children:[e.jsx(F.Trigger,{asChild:!0,children:e.jsx("a",{className:"focus-visible:shadow-borders-focus transition-fg txt-compact-small-plus cursor-pointer text-blue-500 outline-none hover:text-blue-400",children:t("actions.addItems")})}),e.jsxs(F.Content,{children:[e.jsx(F.Header,{}),e.jsx(Pt,{items:o.items,selectedItems:R.map(n=>n.item_id),currencyCode:o.currency_code,onSelectionChange:n=>ue=n}),e.jsx(F.Footer,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(P.Close,{asChild:!0,children:e.jsx(Q,{type:"button",variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(Q,{type:"submit",variant:"primary",size:"small",role:"button",onClick:()=>ke(),children:t("actions.save")},"submit-button")]})})})]})]})]}),G&&e.jsx("div",{style:{background:"repeating-linear-gradient(-45deg, rgb(212, 212, 216, 0.15), rgb(212, 212, 216,.15) 10px, transparent 10px, transparent 20px)"},className:"bg-ui-bg-field mt-4 block h-[56px] w-full rounded-lg border border-dashed"}),R.filter(n=>!!g.get(n.item_id)).map((n,i)=>e.jsx(Tt,{item:u.get(n.item_id),previewItem:g.get(n.item_id),currencyCode:o.currency_code,form:C,onRemove:()=>{var r,f,x;const s=(x=(f=(r=c.find(S=>S.id===n.item_id))==null?void 0:r.actions)==null?void 0:f.find(S=>S.action==="RETURN_ITEM"))==null?void 0:x.id;s&&be(s)},onUpdate:s=>{var f,x;const r=(x=(f=c.find(S=>S.id===n.item_id))==null?void 0:f.actions)==null?void 0:x.find(S=>S.action==="RETURN_ITEM");r&&ye({...s,actionId:r.id},{onError:S=>{var M,ee;(M=r.details)!=null&&M.quantity&&s.quantity&&C.setValue(`items.${i}.quantity`,(ee=r.details)==null?void 0:ee.quantity),X.error(S.message)}})},index:i},n.id)),!G&&e.jsxs("div",{className:"mt-8 flex flex-col gap-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:t("orders.returns.location")}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.locationHint")})]}),e.jsx(m.Field,{control:C.control,name:"location_id",render:({field:{value:n,onChange:i,...s}})=>e.jsx(m.Item,{children:e.jsx(m.Control,{children:e.jsx(Z,{value:n,onChange:r=>{i(r),Pe(r)},...s,options:(v??[]).map(r=>({label:r.name,value:r.id}))})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs(m.Label,{children:[t("orders.returns.inboundShipping"),e.jsxs(V,{size:"small",leading:"compact",className:"text-ui-fg-muted ml-1 inline",children:["(",t("fields.optional"),")"]})]}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.inboundShippingHint")})]}),e.jsx(m.Field,{control:C.control,name:"option_id",render:({field:{value:n,onChange:i,...s}})=>e.jsx(m.Item,{children:e.jsx(m.Control,{children:e.jsx(Z,{allowClear:!0,value:n,onChange:r=>{i(r),Ee(r)},...s,options:(q??[]).filter(r=>(A?r.service_zone.fulfillment_set.location.id===A:!0)&&!!r.rules.find(f=>f.attribute==="is_return"&&f.value==="true")).map(r=>({label:r.name,value:r.id})),disabled:!A,noResultsPlaceholder:e.jsx(Me,{})})})})})]})]}),Te&&e.jsxs(Ct,{variant:"warning",dismissible:!0,className:"mt-4 p-5",children:[e.jsx("div",{className:"text-ui-fg-subtle txt-small pb-2 font-medium leading-[20px]",children:t("orders.returns.noInventoryLevel")}),e.jsx(V,{className:"text-ui-fg-subtle txt-small leading-normal",children:t("orders.returns.noInventoryLevelDesc")})]}),e.jsxs("div",{className:"mt-8 border-y border-dotted py-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:t("orders.returns.returnTotal")}),e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:z(J&&-1*J,o.currency_code)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:t("orders.returns.inboundShipping")}),e.jsxs("span",{className:"txt-small text-ui-fg-subtle flex items-center",children:[!p&&e.jsx(Y,{onClick:()=>y(!0),variant:"transparent",className:"text-ui-fg-muted",disabled:G||!Re,children:e.jsx(Nt,{})}),p?e.jsx(It,{id:"js-shipping-input",onBlur:()=>{let n;l.shipping_methods.forEach(i=>{if(i.actions)for(const s of i.actions)s.action==="SHIPPING_ADD"&&(n=s.id)}),n&&pe({actionId:n,custom_amount:w.float}),y(!1)},symbol:xt[o.currency_code.toUpperCase()].symbol_native,code:o.currency_code,onValueChange:(n,i,s)=>I({value:(s==null?void 0:s.value)||"",float:(s==null?void 0:s.float)||null}),value:w.value,disabled:G}):z(Ae,o.currency_code)]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between border-t border-dotted pt-4",children:[e.jsx("span",{className:"txt-small font-medium",children:t("orders.returns.estDifference")}),e.jsx("span",{className:"txt-small font-medium",children:z(l.summary.pending_difference,o.currency_code)})]})]}),e.jsx("div",{className:"bg-ui-bg-field mt-8 rounded-lg border py-2 pl-2 pr-4",children:e.jsx(m.Field,{control:C.control,name:"send_notification",render:({field:{onChange:n,value:i,...s}})=>e.jsxs(m.Item,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m.Control,{className:"mr-4 self-start",children:e.jsx(rt,{className:"mt-[2px]",checked:!!i,onCheckedChange:n,...s})}),e.jsxs("div",{className:"block",children:[e.jsx(m.Label,{children:t("orders.returns.sendNotification")}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.sendNotificationHint")})]})]}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx("div",{className:"p-8"})]})}),e.jsx(P.Footer,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(P.Close,{asChild:!0,children:e.jsx(Q,{type:"button",variant:"secondary",size:"small",children:t("orders.returns.cancel.title")})}),e.jsx(Q,{type:"submit",variant:"primary",size:"small",isLoading:Ne,children:t("orders.returns.confirm")},"submit-button")]})})})]})})},W=!1,Cs=()=>{const{id:o}=Ze(),l=et(),{t:a}=H(),{order:t}=tt(o,{fields:Ke}),{order:d}=st(o,void 0,{}),[u,c]=j.useState(),{mutateAsync:g}=Fe(t.id),{return:b}=ze(u,void 0,{enabled:!!u});return j.useEffect(()=>{async function p(){if(!(W||!d)){if(d.order_change){d.order_change.change_type==="return_request"?c(d.order_change.return_id):(l(`/orders/${t.id}`,{replace:!0}),X.error(a("orders.returns.activeChangeError")));return}W=!0;try{const y=await g({order_id:t.id});c(y.id)}catch(y){l(`/orders/${t.id}`,{replace:!0}),X.error(y.message)}finally{W=!1}}}p()},[d]),e.jsx(P,{children:b&&d&&t&&e.jsx(Mt,{order:t,activeReturn:b,preview:d})})};export{Cs as Component};
